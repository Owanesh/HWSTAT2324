<!DOCTYPE html>
<html>

<head>
  <title>Joint Distribution Calculator</title>
  <script src="./lib.js"></script>
  <script src="../HW2/utils.js"></script>
</head>

<body>
  <h1>Joint Distribution Calculator</h1>
  <input type="file" id="fileInput" accept=".tsv" />
  <div id="variables"></div>
  <button id="calculateButton">Calculate Joint Distribution</button>
  <div id="intervalInput" style="display: none;">
    <h2>Enter Intervals for Selected Variables:</h2>
    <div id="intervalFields"></div>
    <button id="calculateIntervalButton">Calculate with Intervals</button>
  </div>
  <pre id="output"></pre>
  <pre id="JSS"></pre>

  <script>
    const variables = {};

    function cleanVariables(variable) {
      const variableListSelect = document.getElementById('variableListSelect')
      const selectedValuesFromHTMLElement = getValueFromAMultipleSelect(variableListSelect);
      Object.keys(variables).forEach(elm => {
        if (!selectedValuesFromHTMLElement.includes(elm))
          delete variables[elm]
      });
      document.getElementById('variables').removeChild(variableListSelect);
      return variables
    }


    function jointCalculation(jsonSurvey, variables) {
      const jointDistribution = {};
      console.log(variables)
      // Iterate through the keys in the JSON survey data
      console.log("joint")
      console.log(jointDistribution);
    }



    var content = '';
    var selectedVariables = [];

    document.getElementById('fileInput').addEventListener('change', function (event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();

        reader.onload = function (e) {
          content = e.target.result;
          const lines = content.split('\n');
          const headers = lines[0].split('\t');

          for (let i = 1; i < headers.length; i++) {
            variables[cleanPossibleTypos(headers[i]).toUpperCase()] = new Variable(headers[i]);
          }

          for (let i = 1; i < lines.length; i++) {
            const values = lines[i].split('\t');
            for (let j = 1; j < values.length; j++) {
              const header = cleanPossibleTypos(headers[j]).toUpperCase();
              if (values[j].includes(',')) {
                values[j].split(',').forEach(value => {
                  variables[header].add(value.toUpperCase().trim());
                });
              } else
                variables[header].add(values[j].toUpperCase().trim());
            }
          }
          console.table(variables)
          const variablesContainer = document.getElementById('variables');
          variablesContainer.innerHTML = '';

          var selectList = document.createElement("select");
          selectList.multiple = true;
          selectList.id = "variableListSelect";

          //Create and append the options
          Object.keys(variables).forEach(variable => {
            var option = document.createElement("option");
            option.value = variable;
            option.text = variable;
            selectList.appendChild(option);
          })
          variablesContainer.appendChild(selectList);
        };

        reader.readAsText(file);
      }
    });

    document.getElementById('calculateButton').addEventListener('click', function () {
      jointCalculation(surveyToJSON(content), cleanVariables(variables));
    });
  </script>
</body>

</html>